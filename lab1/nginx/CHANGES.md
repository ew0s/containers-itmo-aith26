# CHANGES – Лабораторная работа 1 (HW 1)

- Добавлен **плохой Dockerfile** (`Dockerfile.bad`):


# Nginx с модулем VTS

Этот Dockerfile создает образ nginx на базе Alpine Linux с дополнительным модулем **nginx-module-vts** (Virtual Host Traffic Status).

## Описание

Dockerfile собирает кастомную версию nginx версии 1.27 с модулем VTS, который предоставляет детальную статистику о трафике и работе виртуальных хостов.

## Что делает Dockerfile

### 1. Базовый образ
- Использует `nginx:1.27-alpine` как базовый образ для минимального размера

### 2. Установка runtime зависимостей
Устанавливает необходимые библиотеки для работы nginx:
- `pcre` - поддержка регулярных выражений
- `openssl` - поддержка SSL/TLS
- `zlib` - сжатие
- `libxslt` - XSLT трансформации
- `gd` - обработка изображений
- `geoip` - геолокация по IP
- `wget` - утилита для загрузки файлов

### 3. Установка build зависимостей
Устанавливает инструменты для компиляции nginx:
- Компилятор `gcc` и библиотеки разработки
- `make` для сборки
- Заголовочные файлы для разработки (`*-dev` пакеты)
- `git` для клонирования модуля VTS

### 4. Скачивание исходников nginx
- Автоматически определяет версию установленного nginx
- Скачивает исходный код nginx той же версии с официального сайта
- Распаковывает архив

### 5. Клонирование модуля VTS
- Клонирует репозиторий [nginx-module-vts](https://github.com/vozlt/nginx-module-vts) из GitHub

### 6. Компиляция nginx с модулем VTS
Компилирует nginx с расширенной конфигурацией, включающей:
- **Модуль VTS** (`--add-module=/tmp/nginx-module-vts`) - для мониторинга трафика
- Множество стандартных модулей nginx:
  - SSL/TLS поддержка
  - HTTP/2
  - Stream модули (для проксирования TCP/UDP)
  - Mail модули
  - Модули для обработки изображений, геолокации, XSLT
  - И многие другие

### 7. Создание необходимых директорий
Создает директории для временных файлов nginx:
- `/var/cache/nginx/client_temp`
- `/var/cache/nginx/proxy_temp`
- `/var/cache/nginx/fastcgi_temp`
- `/var/cache/nginx/uwsgi_temp`
- `/var/cache/nginx/scgi_temp`

### 8. Очистка
- Удаляет build зависимости для уменьшения размера образа
- Очищает временные файлы из `/tmp`

### 9. Настройка пользователя
- Создает пользователя и группу `nginx` с UID/GID 101
- Настраивает безопасный запуск от непривилегированного пользователя

### 10. Конфигурация контейнера
- Открывает порты 80 (HTTP) и 443 (HTTPS)
- Устанавливает сигнал остановки `SIGQUIT`
- Запускает nginx в foreground режиме (`daemon off`)

## Использование

### Сборка образа

```bash
docker build -t nginx-vts lab1/nginx
```

### Запуск контейнера

```bash
docker run -d -p 80:80 -p 443:443 --name nginx-vts-container nginx-vts
```

### Проверка статуса

```bash
docker ps --filter name=nginx-vts-container
```

### Просмотр логов

```bash
docker logs nginx-vts-container
```

### Остановка контейнера

```bash
docker stop nginx-vts-container
```

### Удаление контейнера

```bash
docker rm -f nginx-vts-container
```

## Модуль VTS

Модуль Virtual Host Traffic Status предоставляет JSON API для получения статистики о:
- Количестве запросов
- Переданных байтах
- Статусах ответов
- Статистике по виртуальным хостам
- И другой метрике производительности

Для использования модуля VTS необходимо настроить конфигурацию nginx. Пример конфигурации можно найти в документации модуля: https://github.com/vozlt/nginx-module-vts

## Особенности

- Минимальный размер образа благодаря использованию Alpine Linux
- Оптимизированная сборка с удалением build зависимостей после компиляции
- Безопасный запуск от непривилегированного пользователя
- Полная поддержка всех стандартных модулей nginx
- Дополнительный модуль VTS для мониторинга
